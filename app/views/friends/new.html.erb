<div class="max-w-2xl mx-auto px-4 py-6">
  <!-- Header -->
  <div class="mb-6">
    <%= link_to friends_path, class: "inline-flex items-center text-red-600 hover:text-red-700 font-semibold mb-4" do %>
      <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
      </svg>
      Back to Friends
    <% end %>
    <h1 class="text-2xl font-bold text-gray-900">ðŸŽ„ Add Friend ðŸŽ„</h1>
  </div>

  <!-- Search Bar -->
  <div class="mb-4">
    <input
      type="text"
      id="user-search"
      placeholder="Search users..."
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 outline-none"
    />
  </div>

  <!-- Available Users List -->
  <% if @available_users.any? %>
    <div id="users-list" class="bg-white rounded-lg shadow divide-y divide-gray-200">
      <% @available_users.each do |user| %>
        <div class="user-row px-4 py-3 flex items-center justify-between hover:bg-gray-50 transition-colors" data-username="<%= user.username.downcase %>">
          <div class="flex items-center space-x-3 flex-1">
            <div class="bg-gray-100 rounded-full p-2">
              <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
            </div>
            <div>
              <p class="font-semibold text-gray-900"><%= user.username %></p>
            </div>
          </div>
          <%= button_to friend_requests_path(recipient_id: user.id), class: "bg-red-600 text-white px-3 py-1.5 rounded-lg text-sm font-semibold hover:bg-red-700 transition-colors border-2 border-red-700" do %>
            ðŸŽ„ Send
          <% end %>
        </div>
      <% end %>
    </div>
  <% else %>
    <div class="bg-white rounded-lg shadow p-8 text-center">
      <div class="text-6xl mb-4">ðŸŽ„</div>
      <p class="text-gray-500">No users available to add</p>
      <p class="text-gray-400 text-sm mt-2">You've already sent requests to everyone or they're already your friends</p>
    </div>
  <% end %>
</div>

<script>
  function initializeSearch() {
    const searchInput = document.getElementById('user-search');
    const userRows = document.querySelectorAll('.user-row');
    const usersList = document.getElementById('users-list');

    if (searchInput && userRows.length > 0) {
      searchInput.addEventListener('input', function(e) {
        const searchTerm = e.target.value.toLowerCase().trim();
        let visibleCount = 0;

        userRows.forEach(function(row) {
          const username = row.getAttribute('data-username');
          if (username.includes(searchTerm)) {
            row.style.display = '';
            visibleCount++;
          } else {
            row.style.display = 'none';
          }
        });

        // Show a message if no results found
        const noResultsMsg = document.getElementById('no-results-message');
        if (visibleCount === 0 && searchTerm !== '') {
          if (!noResultsMsg) {
            const msg = document.createElement('div');
            msg.id = 'no-results-message';
            msg.className = 'bg-gray-50 rounded-lg p-6 text-center text-gray-500';
            msg.innerHTML = 'No users found matching "' + searchTerm + '"';
            usersList.parentNode.insertBefore(msg, usersList.nextSibling);
          }
        } else if (noResultsMsg) {
          noResultsMsg.remove();
        }
      });
    }
  }

  // Initialize on page load
  document.addEventListener('DOMContentLoaded', initializeSearch);

  // Re-initialize on Turbo navigation
  document.addEventListener('turbo:load', initializeSearch);
</script>
